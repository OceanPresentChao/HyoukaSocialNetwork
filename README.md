# 分析小说《冰菓》前四部社交网络

## 使用工具

1. Python：Harvesttext

2. TypeScript：graphlib jieba

## 基本思路

### 对原小说文本进行处理

根据小说内容构建小说人物名称词典

如果是国内的小说的话可能直接分词也能有不错的效果，但《冰菓》是日本的小说，Harvesttext对日本名称的分词会有误差。而且不管怎样，具体问题具体分析，制作一个专属的词典一定是能提高分词准确率的。

除了人物正式名称的词典，在小说内同一个人可能会有不同的称呼。比如千反田对折木的称呼是折木同学，里志对折木的称呼是奉太郎。这点也需要人工提取出来，生成一个同义词词典。

制作完词典后使用Harvesttext的add_entities函数生成实体链接

### 统计不同人物的出场次数

这一步需要使用HarvestText进行分段然后分句，对每一句进行分词查看是否有人名词性的词，统计次数。人物的出场次数就是点权。

关于指代消解其实并没怎么解决。同时《冰菓》是第一人称小说，这就又导致指代消解是一个不可避免的问题。我的解决方案是如果一个句子不是他人说的话（即没有被引号括起来），就把“我”都按折木奉太郎来计数。这是一个损失比较小的处理法。

同时注意第3卷，米泽穗信采取的是多视角的写法。此时的“我”就不全是折木奉太郎了。好在视角的转换是分章节的。我们只需要把古典社四人组各自的章节提取出来然后修改“我”的指代，然后再统一合并即可。

### 统计不同人物同框的次数

使用HarvestText的entity_linking函数进行实体链接，如果不同的人出现在了同一个句子里，就在他们之间建一条边，同框的次数就是边的权重。

### 建图

之前的部分其实已经建出了图。不过我只是把数据存成了JSON文件然后在JavaScript里处理了。因为后面还用到了echarts来做可视化。对图的操作主要用到了graphlib库。

图的定义就是整部《冰菓》的社交网络。人物的出场次数是点权，两个人物间同时出场的次数是边权。

### PageRank算法

建好图后对图进行pagerank算法，可以得到每个人物的PR值，代表了其在整部《冰菓》里的重要程度。毕竟出场次数只能说明米泽穗信本人对其的偏爱程度嘛~

## 关于后续

后续还做了可视化，还爬了b站上关于《冰菓》的评论提取关键词做了一个词云。可视化使用Vue、Echarts制作。这边因为有文件操作只能跑在node端所以就不在这边传了www

## 更新：

最终成功展示已完成。

[《冰菓》社交网络Demo](https://oceanpresentchao.github.io/HyoukaSocialNetwork/)
